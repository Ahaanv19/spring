    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>User Table</title>
        <!-- Add jQuery first -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js library -->
        <style>
                .sort-icon {
                    cursor: pointer;
                    margin-left: 5px;
                    font-size: 0.8em;
                    color: #555;
                }
                .sort-icon.asc::after {
                    content: "↑"; /* Up arrow for ascending */
                }
                .sort-icon.desc::after {
                    content: "↓"; /* Down arrow for descending */
                }
        </style>
        
    </head>
    <body>
        <h2>Logs of All Users</h2>
        <table border="1" id="userTable">
            <thead>
                <tr>
                    <th>
                        User ID
                        <span data-column="0" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        User Name
                        <span data-column="1" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        Login Date
                        <span data-column="2" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        Day of Week
                        <span data-column="3" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        Login Time
                        <span data-column="4" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        Logout Time
                        <span data-column="5" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                    <th>
                        Duration (minutes)
                        <span data-column="6" class="sort-icon asc"></span> <!-- Default ascending -->
                    </th>
                </tr>
            </thead>
            
            
            <tbody>
                <tr th:each="user_history : ${users_history}">
                    <td th:text="${user_history.userId}"></td>
                    <td th:text="${user_history.userName}"></td>
                    <td th:text="${user_history.loginDate}"></td>
                    <td th:text="${user_history.dayOfWeek}"></td>
                    <td th:text="${user_history.loginTime}"></td>
                    <td th:text="${user_history.logoutTime}"></td>
                    <td th:text="${user_history.duration}"></td>
                </tr>
            </tbody>
        </table>
        
        <script>
            $(document).ready(function () {
                $('.sort-icon').on('click', function () {
                    var column = $(this).data('column'); // Get the column index
                    var table = $('#userTable'); // Get the table
                    var rows = table.find('tbody > tr').get(); // Get all rows
            
                    // Check the current state and toggle accordingly
                    var isAsc = $(this).hasClass('asc');
                    $(this).removeClass('asc desc'); // Clear classes from all icons
                    if (isAsc) {
                        $(this).addClass('desc'); // Toggle to descending
                    } else {
                        $(this).addClass('asc'); // Toggle back to ascending
                    }
            
                    // Perform sorting
                    rows.sort(function (a, b) {
                        var cellA = $(a).children('td').eq(column).text();
                        var cellB = $(b).children('td').eq(column).text();
            
                        // Numeric or text sorting based on content
                        if ($.isNumeric(cellA) && $.isNumeric(cellB)) {
                            return isAsc ? cellB - cellA : cellA - cellB; // Numeric comparison
                        } else {
                            return isAsc
                                ? cellB.localeCompare(cellA) // Descending order
                                : cellA.localeCompare(cellB); // Ascending order
                        }
                    });
            
                    // Append sorted rows back to the table
                    $.each(rows, function (index, row) {
                        table.children('tbody').append(row);
                    });
                });
            });
    
        </script>

        <!-- Table for Total Duration -->
        <h3>Total Duration for the Week</h3>
        <table border="1">
            <tr>
                <th>User Name</th>
                <th>Total Duration (minutes)</th>
            </tr>
            <!-- <tr th:each="userName, duration : ${totalDurationMap}">
                <td th:text="${userName}"></td>
                <td th:text="${duration}"></td>
            </tr> -->
            <tr th:each="entry : ${totalDurationMap}">
                <td th:text="${entry.key}"></td> <!-- Access userId (key) -->
                <td th:text="${entry.value}"></td> <!-- Access formatted duration (value) -->
            </tr>
        </table>
    
        <!-- Table for Total Occurrences -->
        <h3>Total Occurrences for the Week</h3>
        <table border="1">
            <tr>
                <th>User Name</th>
                <th>Total Occurrences</th>
            </tr>
            <!-- <tr th:each="userName, occurrences : ${totalOccurrencesMap}">
                <td th:text="${userName}"></td>
                <td th:text="${occurrences}"></td>
            </tr> -->
            <tr th:each="entry : ${totalOccurrencesMap}">
                <td th:text="${entry.key}"></td> <!-- Access userId (key) -->
                <td th:text="${entry.value}"></td> <!-- Access total occurrences (value) -->
            </tr>
        </table>
    
        <!-- Table for Average Duration per Day -->
        <h3>Average Duration per Day</h3>
        <table border="1">
            <tr>
                <th>User Name</th>
                <th>Average Duration per Day (HH:MM:SS)</th>
            </tr>
            <!-- <tr th:each="userName, avgDuration : ${avgDurationPerDayMap}">
                <td th:text="${userName}"></td>
                <td th:text="${avgDuration}"></td>
            </tr> -->
            <tr th:each="entry : ${avgDurationPerDayMap}">
                <td th:text="${entry.key}"></td> <!-- Access userId (key) -->
                <td th:text="${entry.value}"></td> <!-- Access formatted average duration (value) -->
            </tr>
        </table>
    

        <!-- Bar Chart for Total Duration -->
        <h3>Total Duration per User (Minutes)</h3>
        <canvas id="totalDurationChart" width="400" height="200"></canvas>


        <script th:inline="javascript">
            // Convert totalDurationMap data from Thymeleaf to JSON
            /*<![CDATA[*/
            const totalDurationData = /*[[${totalDurationMap}]]*/ {};
            /*]]>*/

            // Prepare data for Chart.js
            const userIds = Object.keys(totalDurationData); // Array of user IDs
            const durations = Object.values(totalDurationData).map(duration => parseInt(duration)); // Array of durations in minutes

            console.log("User IDs:", userIds); // Log to check
            console.log("Durations:", durations); // Log to check

            // Set up Chart.js bar chart
            const ctx = document.getElementById('totalDurationChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: userIds, // User IDs as labels on the X-axis
                    datasets: [{
                        label: 'Total Duration (Minutes)',
                        data: durations,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Bar color
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Duration (Minutes)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'User ID'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        </script>


        <!-- Bar Chart for Average Duration -->
        <h3>Average Duration per User (Minutes)</h3>
        <canvas id="avgDurationChart" width="400" height="200"></canvas>


        <script th:inline="javascript">
            // Convert totalDurationMap data from Thymeleaf to JSON
            /*<![CDATA[*/
            const avgDurationData = /*[[${avgDurationPerDayMap}]]*/ {};
            /*]]>*/

            // Prepare data for Chart.js
            const userIds2 = Object.keys(avgDurationData); // Array of user IDs
            const durations2 = Object.values(avgDurationData).map(duration => parseInt(duration)); // Array of durations in minutes

            console.log("User IDs:", userIds2); // Log to check
            console.log("Durations:", durations2); // Log to check

            // Set up Chart.js bar chart
            const ctx2 = document.getElementById('avgDurationChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: userIds2, // User IDs as labels on the X-axis
                    datasets: [{
                        label: 'Total Duration (Minutes)',
                        data: durations2,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Bar color
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Duration (Minutes)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'User ID'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        </script>


    </body>
    </html>